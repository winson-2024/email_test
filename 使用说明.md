# 临时邮箱系统使用说明

## 🎯 系统概述

本系统集成了真实的第三方邮件服务API，支持创建临时邮箱并接收真实邮件。系统已优化邮件获取功能，确保能正常接收邮件，并实现了kpay+001格式的邮箱前缀和唯一性验证。

## 🔧 已解决的核心问题

### ✅ 1. 邮件持久化存储
- **问题**: 历史发送的邮件没有保存在邮箱列表，刷新页面后邮件都消失
- **解决方案**: 
  - 实现了localStorage本地存储
  - 服务器端文件存储(email_storage.json)
  - 双重保障确保数据不丢失

### ✅ 2. 验证码检测优化
- **问题**: 检测验证码页面验证码与邮箱的验证码不一致
- **解决方案**:
  - 增强型验证码识别算法
  - 支持多种验证码格式(4-8位数字)
  - 中英文验证码文本识别
  - 正则表达式精确匹配

### ✅ 3. 随意点击页面新增数据问题
- **问题**: 随意点击页面就会新增数据
- **解决方案**:
  - 修复了事件冒泡导致的重复触发
  - 添加了防重复点击机制
  - 优化了事件绑定和解绑逻辑

### ✅ 4. 邮箱前缀优化
- **问题**: 邮箱前缀需要简化为kpay+001格式
- **解决方案**:
  - 实现kpay001、kpay002...格式
  - 唯一性验证避免重复
  - 自动递增计数器

## 🌟 集成的第三方邮件服务

### 1. Snapmail API
- **状态**: 已集成(当前API端点需要更新)
- **域名**: snapmail.cc
- **特点**: 支持前缀匹配，API功能完整

### 2. GuerrillaMail API  
- **状态**: ✅ 可用
- **域名**: guerrillamail.info, guerrillamail.biz, guerrillamail.com等
- **特点**: 稳定可靠，支持自定义前缀

## 📋 系统功能特性

### 🔥 核心功能
1. **真实邮件接收**: 对接第三方API，接收真实邮件
2. **kpay格式邮箱**: kpay001@domain.com格式
3. **唯一性验证**: 防止邮箱前缀重复
4. **数据持久化**: 刷新页面数据不丢失
5. **验证码检测**: 智能识别和提取验证码
6. **服务状态监控**: 实时检测API服务可用性

### 🎨 界面优化
1. **现代化UI**: 参考目标效果图重新设计
2. **双栏布局**: 左侧邮箱列表，右侧邮件内容
3. **服务状态面板**: 实时显示服务可用性
4. **新邮件提醒**: 动画效果和通知提示

## 🚀 使用方法

### 1. 创建邮箱
```
1. 点击"创建新邮箱"按钮
2. 系统自动生成kpay001@domain.com格式邮箱
3. 显示邮箱地址和服务提供商信息
```

### 2. 接收邮件
```
1. 使用创建的邮箱地址接收邮件
2. 点击"刷新"按钮获取最新邮件
3. 系统自动检测验证码并高亮显示
```

### 3. 查看邮件详情
```
1. 点击邮件项查看详细内容
2. 支持HTML和纯文本格式
3. 一键复制验证码功能
```

## 🔍 验证邮件服务对接成功的方法

### 1. 服务状态检查
- 左侧面板显示服务状态(🟢活跃/🔴错误)
- 可用域名数量实时更新
- 点击刷新按钮重新检测

### 2. 邮箱创建测试
- 点击"创建新邮箱"按钮
- 系统自动选择可用服务
- 显示真实邮箱地址和服务提供商

### 3. 邮件接收验证
- 使用创建的邮箱地址接收邮件
- 点击"刷新"按钮获取最新邮件
- 查看邮件详情和验证码检测

### 4. 控制台日志验证
```bash
# 查看服务器日志
node server.js

# 观察以下日志信息:
- 服务状态检查结果
- 邮箱创建成功信息
- 邮件获取请求和响应
- API调用状态
```

## 📊 当前系统状态

- **服务器**: ✅ 运行中 (http://localhost:3000)
- **可用服务**: GuerrillaMail (1/2)
- **邮箱格式**: kpay001@guerrillamail.com
- **数据存储**: email_storage.json
- **服务监控**: service_status.json

## 🛠️ 技术实现

### 后端技术栈
- **Node.js + Express**: 服务器框架
- **Axios**: HTTP请求库
- **文件系统存储**: JSON格式数据持久化

### 前端技术栈
- **原生JavaScript**: 无框架依赖
- **现代CSS3**: 响应式设计
- **LocalStorage**: 本地数据缓存

### API集成
- **RESTful API**: 标准化接口设计
- **错误处理**: 完善的异常处理机制
- **超时控制**: 防止请求阻塞

## 🔧 故障排除

### 1. 邮件接收不到
```
- 检查服务状态面板
- 确认API服务可用性
- 查看控制台错误信息
- 尝试刷新服务状态
```

### 2. 验证码识别错误
```
- 检查邮件内容格式
- 验证正则表达式匹配
- 查看邮件原始文本
```

### 3. 页面数据丢失
```
- 检查localStorage存储
- 确认服务器文件存储
- 验证数据同步机制
```

## 📈 系统优势

1. **真实邮件服务**: 对接第三方API，非模拟数据
2. **数据可靠性**: 双重存储保障，数据不丢失
3. **用户体验**: 现代化界面，操作流畅
4. **扩展性强**: 支持多个邮件服务提供商
5. **监控完善**: 实时服务状态检测

## 🎯 使用建议

1. **测试验证码**: 使用知名网站(如GitHub、Google)发送验证邮件测试
2. **定期刷新**: 手动点击刷新按钮获取最新邮件
3. **服务切换**: 如果一个服务不可用，系统会自动切换到其他可用服务
4. **数据备份**: 重要邮件建议及时保存或截图

---

**系统已完全解决用户提出的所有问题，提供稳定可靠的临时邮箱服务！**